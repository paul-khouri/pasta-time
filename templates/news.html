{% extends "layout.html" %}

{% block title %}
Our News
{% endblock %}

{% block banner %}
static/images/small_banner.svg
{% endblock %}


{% block content %}



<div class="container-lg py-sm-5 py-1">
     <h1> News</h1>
    {% if session and session['authorisation'] == 0 %}
    <div class="news p-4 my-4 text-end">
        <a class="btn btn-primary" href="{{ url_for('news_cud', id=0, task='add') }}">Add News</a>
    </div>
    {% endif %}


    {% for row in news %}
    <div class="news p-4 my-4">
    <h2> {{ row['title'] }}</h2>
        <div class="subtitle"> {{ row['subtitle'] }}</div>
        <p class="news-text"> {{ row['content'] | replace("\n", "<br>") | safe}} </p>
        <div class="news-meta">Posted by {{ row['name'] }} on {{ row['newsdate'] | news_date }}</div>
        {% if session and session['authorisation'] == 0 %}
        <div class="news-meta">
            <a class="btn btn-primary" href="{{ url_for('news_cud', id=row['news_id'], task='update') }}">Update</a>
            <a class="btn btn-primary" href="{{ url_for('news_cud', id=row['news_id'], task='delete') }}">Delete</a>
        </div>
        {% endif %}
        <h3>Comments</h3>
        {% for comment in row['comments'] %}
        <div class="comment">
             <div>Posted by {{comment['name']}} on {{ comment['commentdate'] | news_date }} </div>
            <div>{{ comment['comment'] }}</div>
            <div >
                <a class="btn btn-primary" href="{{ url_for('comment_cud', id=comment['comment_id'], task='delete') }}">X</a>
            </div>
        </div>
        {% endfor %}

                <div>
            {% if session and session['authorisation'] in [0,1] %}
            <form action="{{url_for('comment_cud', news_id=row['news_id'], member_id=session['id'],task='add')}}" method="POST">
                <div>
                    <label for="comment" class="form-label">Your comment</label>
                    <textarea class="form-control" id="comment" name="comment" rows="1" required>{{content}}</textarea>
                </div>
                    <div class="text-end">
                    <button  type="submit" class="btn btn-primary" >Submit</button>
                </div>
            </form>
                {% endif %}

        </div>
    </div>
    {% endfor %}

</div>

{% endblock %}